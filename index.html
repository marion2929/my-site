<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>まりおんのサイト | ホーム</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- フォント（ポップな見た目用。既に読み込んでいたら二重で入れないでOK） -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ここに共通ヘッダーを差し込む -->
<div data-include="partials/header.html"></div>

<main>
  <h2>ようこそ！</h2>
  <p>ここは私の創作物を置くWebサイトです。</p>

  <!-- スライドショー（最初は適当な2枚。JSがランダムな先頭2枚に差し替えます） -->
  <div class="hero-rotator" aria-label="景色ギャラリー">
    <img id="heroA" class="active" src="images/FADO/FADO01.png" alt="景色A">
    <img id="heroB" src="images/FADO/FADO02.png" alt="景色B">
  </div>
</main>

<footer>
  <p>© 2025 まりおん All rights reserved.</p>
</footer>

<!-- スマホ用メニュー開閉 -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('menuBtn');
    const nav = document.getElementById('siteNav');
    if (!btn || !nav) return;
    btn.addEventListener('click', () => {
      const open = document.body.classList.toggle('nav-open');
      btn.setAttribute('aria-expanded', open ? 'true' : 'false');
    });
    nav.addEventListener('click', (e) => {
      if (e.target.tagName === 'A') {
        document.body.classList.remove('nav-open');
        btn.setAttribute('aria-expanded', 'false');
      }
    });
  });
</script>

<!-- ヒーロースライドショー：ランダム順・31枚対応 -->
<script>
  // 1) 画像配列を 01〜31 で自動生成
  const slides = Array.from({ length: 31 }, (_, i) => {
    const n = String(i + 1).padStart(2, '0'); // 01, 02, …, 31
    return { src: `images/FADO/FADO${n}.png`, alt: `景色${i + 1}` };
  });

  // 2) フィッシャー–イェーツでランダムに並べ替え
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  shuffle(slides);

  const imgA = document.getElementById('heroA');
  const imgB = document.getElementById('heroB');
  let current = 0;     // 現在のインデックス（slides[current] が次に向かう先）
  let showingA = true; // どちらを前面に出しているか
  let timer;

  // 初期表示をランダム先頭2枚に合わせる
  (function initFirstTwo() {
    if (!imgA || !imgB || slides.length < 2) return;
    imgA.src = slides[0].src; imgA.alt = slides[0].alt;
    imgB.src = slides[1].src; imgB.alt = slides[1].alt;
    current = 1; // 次は index 2 へ
  })();

  function nextIndex(i) {
    return (i + 1) % slides.length;
  }

  // 画像切替（先読み → フェード）
  function swap() {
    const next = nextIndex(current);
    const target = showingA ? imgB : imgA;

    const pre = new Image();
    pre.onload = () => {
      target.src = slides[next].src;
      target.alt = slides[next].alt;

      if (showingA) {
        imgA.classList.remove('active');
        imgB.classList.add('active');
      } else {
        imgB.classList.remove('active');
        imgA.classList.add('active');
      }
      showingA = !showingA;
      current = next;
    };
    pre.onerror = () => {
      console.warn('画像を読み込めませんでした:', slides[next].src);
      current = next;         // 問題の画像はスキップ
      setTimeout(swap, 0);    // すぐ次へ
    };
    pre.src = slides[next].src;
  }

  function start() {
    stop();
    if (slides.length >= 2) {
      timer = setInterval(swap, 5000); // 5秒ごと（お好みで変更OK）
    }
  }
  function stop() { if (timer) clearInterval(timer); }

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) stop(); else start();
  });

  start();
</script>
<script src="js/include.js"></script>
</body>
</html>
